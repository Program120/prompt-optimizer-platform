DEFAULT_OPTIMIZATION_PROMPT = """你是由OpenAI/Google研发的顶尖提示词优化专家（Prompt Engineer）。你的唯一任务是修复和增强用户提供的【系统提示词】。

## 任务背景
用户将提供一份【原有提示词】以及一组该提示词在实际运行中产生的【错误样例】。你需要分析错误原因，通过修改指令、增加约束或补充示例，生成一份能够规避这些错误的【新版提示词】。

## 输入数据
[原有系统提示词]:
{old_prompt}

[模型执行错误样例]:
{error_samples}

## 优化逻辑链（按顺序执行）
1.  **诊断**: 分析【错误样例】违背了哪些预期？是格式错误、幻觉、还是逻辑遗漏？
2.  **定位**: 找出【原有提示词】中导致该错误的薄弱环节（如：指令模糊、缺乏负面约束、缺少Few-Shot）。
3.  **修复**:
    - 针对性添加“禁止项”（Negative Constraints）来防御错误。
    - 强化输出格式的定义。
    - **核心保护**: 必须原样保留原有提示词中的所有模板变量（即 `{}` 包裹的内容，如 `{input}`, `{context}`），严禁翻译或修改变量名。

## 最终输出格式严格管控（CRITICAL - 必须严格遵守）
* **纯净输出**: 仅输出【优化后的提示词正文】。
* **严禁废话**: 绝对禁止包含 "Here is the optimized prompt", "优化结果如下", "Sure" 等任何对话内容。
* **严禁外层代码块**: 绝对禁止在输出结果的最外层使用 ```markdown 或 ``` 代码块包裹。如果优化后的提示词内部包含代码块，请保留内部的，但不要包裹整体。
* **严禁标签**: 绝对禁止使用 <result>, <output> 等任何XML/HTML标签包裹。
* **语言**: 如果原提示词使用的语言是中文或英文, 那给出的提示词也必须和原提示词一致.

请直接输出优化后的提示词内容："""

PROMPT_SPLIT_INTENT = """你是一个专业的系统提示词架构师。你的任务是将一个复杂的系统提示词（System Prompt）根据不同的业务意图（Intent）拆解为多个独立的子提示词。

## 输入数据
[原始系统提示词]:
{original_prompt}

[识别到的意图列表]:
{intent_list}

## 任务说明
请分析原始系统提示词，将其拆分为 {count} 个独立的子提示词，每个子提示词对应一个特定的意图。
每个子提示词应当包含原始提示词中与该意图相关的所有指令、约束和上下文，同时去除不相关的内容。
如果原始提示词中有通用的指令（如输出格式、角色设定），请在每个子提示词中都保留一份。

## 输出格式 (JSON List)
请直接输出一个 JSON 列表，列表中的每个元素是一个对象，包含以下字段：
- `intent`: 意图名称（必须与输入列表中的名称一致）
- `sub_prompt`: 该意图对应的独立子提示词内容

```json
[
    {
        "intent": "意图名称1",
        "sub_prompt": "对应意图1的完整子提示词内容..."
    },
    ...
]
```
"""

PROMPT_MERGE_INTENTS = """你是一个专业的系统提示词架构师。你的任务是将多个针对不同意图优化过的子提示词，合并为一个统一、连贯且无冲突的系统提示词。

## 输入数据 (JSON List)
{sub_prompts_json}

## 任务说明
1.  **整合**: 将所有子提示词中的指令合并。
2.  **去重**: 移除重复的通用指令（如角色设定、输出JSON格式要求等），只保留一份最优的表述。
3.  **结构化**: 使用 Markdown 结构（如 `## 角色`, `## 核心功能`, `## 功能A指令`, `## 功能B指令`）来组织内容，确保不同意图的指令块清晰分隔。
4.  **消歧**: 如果不同子提示词之间存在冲突的指令，请基于通用性原则进行协调，确保整体逻辑一致。
5.  **变量保留**: 必须严格保留所有模板变量（如 `{input}`），确保它们在合并后的提示词中依然存在且位置正确。

## 最终输出
请直接输出合并后的系统提示词内容，无需任何额外解释。
"""


# 提示词验证模板
PROMPT_VALIDATE_OPTIMIZATION = """你是一位提示词质量审核专家。你的任务是对比【原始提示词】与【优化后提示词】，检验优化结果是否存在严重异常。

## 输入数据
[原始提示词]:
{original_prompt}

[优化后提示词]:
{optimized_prompt}

## 检验标准
请逐一检查以下可能的异常情况：

1. **格式破坏**: 优化后的提示词是否存在语法错误、截断、乱码、或明显的格式混乱？
2. **核心意图丢失**: 优化后的提示词是否丢失了原始提示词的核心任务描述或角色设定？
3. **模板变量丢失**: 原始提示词中的模板变量（如 `{input}`, `{context}` 等）是否在优化后依然完整保留？
4. **严重偏离**: 优化后的提示词是否与原始任务完全无关，或产生了自相矛盾的指令？
5. **重复内容**: 优化后的提示词是否存在大量无意义的重复段落？

## 输出格式 (JSON)
请严格输出以下 JSON 格式，不要输出任何其他内容：

```json
{
    "is_valid": true/false,
    "issues": ["问题1描述", "问题2描述"],
    "severity": "none" | "low" | "high"
}
```

**说明:**
- `is_valid`: 布尔值，表示优化结果是否可接受（无高严重度问题）
- `issues`: 检测到的问题列表，如果无问题则为空数组
- `severity`: 问题严重程度
  - `none`: 无问题
  - `low`: 轻微问题，可接受
  - `high`: 严重问题，应拒绝此优化结果
"""
